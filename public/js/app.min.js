"use strict";const btn=document.querySelector(".button_submit"),work=document.querySelector(".work"),amount=document.querySelector(".amount"),phone=document.querySelector(".phone"),form=document.getElementById("form");let lat,lng,myPlacemark,newPlacemark;const test=document.getElementById("test");let key;phone.addEventListener("click",(function(e){phone.value="+7",phone.focus(),phone.selectionStart=phone.value.length})),navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(e){const{latitude:o,longitude:t}=e.coords;lat=o,lng=t;const n=[lat,lng];ymaps.ready((function(){const e=new ymaps.Map("map",{center:n,zoom:13},{searchControlProvider:"yandex#search"});myPlacemark=new ymaps.Placemark(n,{iconCaption:"Вы здесь"},{preset:"islands#greenDotIconWithCaption"}),e.geoObjects.add(myPlacemark),e.events.add("click",(function(o){console.log(o.get("coords")),[lat,lng]=o.get("coords"),newPlacemark&&e.geoObjects.remove(newPlacemark),newPlacemark=new ymaps.Placemark([lat,lng],{iconCaption:"Кординаты зафиксированы"},{preset:"islands#greenDotIconWithCaption"}),console.log(newPlacemark),e.geoObjects.add(newPlacemark),console.log(e.geoObjects)}))}))}),(function(){alert("something wrong")}));const getKey=async function(){const e=await fetch("http://localhost:8013"),o=await e.json();key=await o[0].key,console.log(o),console.log(key)};getKey(),test.addEventListener("submit",(function(e){e.preventDefault(),console.log(e.target),console.log(this);let o=new FormData(test);console.log(o),fetch(`https://api.telegram.org/bot${key}/sendMessage`,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(Object.fromEntries(o))})})),btn.addEventListener("click",(function(){if(console.log(phone.value.slice(0,1)),"8"===phone.value.slice(0,1)||12!==phone.value.length)return alert("Пожалуйста введите номер в нужном формате"),void(phone.value="");""===amount.value?amount.value="Клиент":amount.value,fetch(`https://api.telegram.org/bot${key}/sendMessage`,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({chat_id:"-981192490",text:`НОВЫЙ ЗАКАЗ:\nВид работ: ${work.value},\nИмя клиента: ${amount.value},\nТелефон клиента: ${phone.value}`})}),fetch(`https://api.telegram.org/bot${key}/sendContact`,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({chat_id:"-981192490",first_name:`${amount.value}`,phone_number:`${phone.value}`})}),fetch(`https://api.telegram.org/bot${key}/sendMessage`,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify({chat_id:"-981192490",text:`https://yandex.ru/maps/?ll=${lng}%2C${lat}&mode=whatshere&whatshere%5Bpoint%5D=${lng}%2C${lat}&whatshere%5Bzoom%5D=16&z=16`})}),amount.value="",phone.value="",alert("заявка отправлена")}));